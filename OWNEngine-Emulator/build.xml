<project name="OWN-Engine-Emulator" default="create.dist" basedir=".">
	
	<!-- Emulator Jar -->
	<property name="emu.name" value="own-engine-emu" />
	<property name="emu.version" value="0.2.0" />
	<property name="jar.emu.name" value="${emu.name}-${emu.version}" />

	<!-- general -->
	<property name="project.home" value="${basedir}" />
	<property name="workspace" value="${project.home}/.." />
	<property name="dest" value="dest" />
	<property name="dir.dist" value="${project.home}/${dest}" />
	

	<property name="build" value="${project.home}/bin" />
	<property name="lib.dir" value="/lib" />
	<property name="conf.dir" value="/conf" />

	<path id="classpath">
		<fileset dir="${dir.dist}${lib.dir}" includes="*.jar" />
	</path>

	<tstamp>
		<format property="TODAY" pattern="dd/MM/yyyy" />
	</tstamp>

<target name="clean" description="Destroys all generated files and dirs.">
	<delete dir="${dir.dist}" />
</target>

<target name="prepare.dist"> <!-- depends="clean">-->
	<mkdir dir="${dir.dist}/${lib.dir}" />
	<mkdir dir="${dir.dist}/${conf.dir}" />
	
	<!-- copy the libs that you need to "lib" directory  -->
	<copy todir="${dir.dist}${lib.dir}">
		<fileset dir="${project.home}${lib.dir}" includes="*.jar" />
	</copy>
</target>
	
<target name="jar.emu" depends="prepare.dist">
	<manifestclasspath property="jar.emu.classpath" jarfile="${dir.dist}/${lib.dir}/${jar.emu.name}.jar">
		<classpath refid="classpath" />
	</manifestclasspath>

	<echo message="lib: ${jar.emu.classpath}" level="debug" />

	<!-- creates your jar with the contents inside "bin" (now with your .class and .jar dependencies) -->
	<jar destfile="${dir.dist}/${lib.dir}/${jar.emu.name}.jar">
		<fileset dir="${build}">
			<include name="**/*.class" />
			<include name="**/*.properties" />
			<exclude name="**/test/*.class" />
			<exclude name="**/bus/*.class" />
			<exclude name="**/server/*.class" />
			<exclude name="**/plugin/*.class" />
			<exclude name="**/test/*.class" />
			<exclude name="**/sdk/*.class" />
		</fileset>
		<manifest>
			<!-- Who is building this jar? -->
			<attribute name="Built-By" value="${user.name}" />
			<!-- Information about the program itself -->
			<attribute name="Implementation-Title" value="${emu.name}" />
			<attribute name="Implementation-Version" value="${emu.version}" />
			<attribute name="Class-Path" value="${jar.emu.classpath}" />
			<attribute name="Built-Date" value="${TODAY}" />
		</manifest>
	</jar>
</target>

<target name="create.dist" depends="prepare.dist, jar.emu" description="prepeare the relese of the dist">
	<!-- copy the louncher to "dist" directory  -->
	<copy todir="${dir.dist}">
		<!-- fileset dir="${project.home}" includes="*.bat" -->
		<!-- fileset dir="${project.home}" includes="*.sh" -->
		<fileset dir="${project.home}" includes="lgpl-3.0.txt" />
	</copy>

	<!-- copy the configutation to "conf" directory  -->
	<copy todir="${dir.dist}${conf.dir}">
		<fileset dir="${project.home}${conf.dir}" includes="emuNew.xml" />
	</copy>
</target>
	
<target name="copy.jar" description="copy jar from other project to lib dir">
	
	<delete verbose="true">
		<fileset dir="${project.home}/${lib.dir}" casesensitive="false">
		    <include name="own-*"/>
		</fileset>
	</delete>
</target>
	
</project>